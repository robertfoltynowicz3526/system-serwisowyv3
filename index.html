<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>System Serwisowy</title>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="/main.js" defer></script>
  </head>
  <body>

    <header>
        <h1>System Serwisowy</h1>
        <nav>
            <button class="tab-button" onclick="openTab(event, 'pulpit')">Pulpit</button>
            <button class="tab-button" onclick="openTab(event, 'klienci')">Klienci</button>
            <button class="tab-button" onclick="openTab(event, 'maszyny')">Maszyny</button>
            <button class="tab-button" onclick="openTab(event, 'zlecenia')">Zlecenia</button>
            <button class="tab-button" onclick="openTab(event, 'magazyn')">Magazyn</button>
            </nav>
    </header>

    <main>
        <div id="pulpit" class="tab-content active">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Aktywne Zlecenia</h3>
                    <p class="dashboard-value" id="active-orders-count">0</p>
                </div>
                <div class="dashboard-card">
                    <h3>Przychód M-c (netto)</h3>
                    <p class="dashboard-value" id="monthly-net-revenue">0.00 zł</p>
                </div>
                <div class="dashboard-card">
                    <h3>Produkty do Zamówienia</h3>
                    <p class="dashboard-value" id="low-stock-count">0</p>
                </div>
                <div class="dashboard-card">
                    <h3>Najbliższe Zlecenia/Spotkania</h3>
                    <ul class="dashboard-list" id="upcoming-events-list">
                        <li>Brak</li>
                    </ul>
                </div>
            </div>

            <hr>
            <div class="calendar-container">
                <h2>Kalendarz Zleceń / Spotkań</h2>
                <div id='calendar'></div>
            </div>
        </div>
        
        <div id="klienci" class="tab-content">
            <h2>Baza Klientów</h2>
            <div class="form-section">
                <h3>Dodaj nowego klienta</h3>
                <form id="klient-form">
                    <div class="form-group"><label for="klient-nazwa">Nazwa / Imię i nazwisko:</label><input type="text" id="klient-nazwa" required></div>
                    <div class="form-group"><label for="klient-nip">NIP (opcjonalnie):</label><input type="text" id="klient-nip"></div>
                    <div class="form-group"><label for="klient-adres">Adres (opcjonalnie):</label><input type="text" id="klient-adres"></div>
                    <div class="form-group"><label for="klient-telefon">Telefon (opcjonalnie):</label><input type="text" id="klient-telefon"></div>
                    <button type="submit">Dodaj Klienta</button>
                </form>
            </div>
            <div class="table-section"><h3>Lista Klientów</h3><ul id="lista-klientow"></ul></div>
        </div>

        <div id="maszyny" class="tab-content">
            <h2>Baza Maszyn</h2>
            <div class="form-section">
                <h3>Dodaj nową maszynę</h3>
                <form id="maszyna-form">
                    <div class="form-group"><label for="maszyna-klient-select">Wybierz klienta:</label><select id="maszyna-klient-select" required><option value="">-- Najpierw dodaj klienta --</option></select></div>
                    <div class="form-group"><label for="maszyna-typ">Typ Maszyny:</label><select id="maszyna-typ" required><option value="">-- Wybierz typ --</option><option value="Traktor">Traktor</option><option value="Kombajn">Kombajn</option><option value="Prasa">Prasa</option><option value="Sieczkarnia">Sieczkarnia</option><option value="Opryskiwacz">Opryskiwacz</option><option value="Inna">Inna</option></select></div>
                    <div class="form-group"><label for="maszyna-model">Model:</label><input type="text" id="maszyna-model" placeholder="Np. 6155M" required></div>
                    <div class="form-group"><label for="maszyna-serial">Numer seryjny:</label><input type="text" id="maszyna-serial"></div>
                    <div class="form-group"><label for="maszyna-rok">Rok produkcji:</label><input type="number" id="maszyna-rok"></div>
                    <div class="form-group"><label for="maszyna-mth">Aktualne motogodziny:</label><input type="number" step="0.1" id="maszyna-mth"></div>
                    <button type="submit">Dodaj Maszynę</button>
                </form>
            </div>
            <div class="table-section"><h3>Lista Maszyn</h3><div id="lista-maszyn"></div></div>
        </div>
        <div id="zlecenia" class="tab-content">
            <h2>Zlecenia</h2>
            <div class="form-section">
                <h3>Dodaj nowe zlecenie</h3>
                <form id="zlecenie-form">
                    <div class="form-group"><label for="zlecenie-klient-select">1. Wybierz klienta (opcjonalnie):</label><select id="zlecenie-klient-select"><option value="">-- Wybierz --</option></select></div>
                    <div class="form-group"><label for="zlecenie-maszyna-select">2. Wybierz maszynę (opcjonalnie):</label><select id="zlecenie-maszyna-select" disabled><option value="">-- Najpierw wybierz klienta --</option></select></div>
                    <div class="form-group"><label for="nr-zlecenia">Nr zlecenia / Nazwa dla szybkiego zlecenia:</label><input type="text" id="nr-zlecenia" required></div>
                    <div class="form-group"><label for="opis-usterki">Opis usterki:</label><textarea id="opis-usterki" rows="3"></textarea></div>
                    <div class="form-group"><label for="motogodziny">Motogodziny (opcjonalnie):</label><input type="number" id="motogodziny" step="0.1"></div>
                    <button type="submit">Dodaj Zlecenie</button>
                </form>
            </div>

            <div class="form-section" style="padding: 1rem;">
                <input type="search" id="szukaj-zlecenia" placeholder="Szukaj po kliencie, maszynie, opisie, nr zlecenia...">
            </div>

            <div class="table-section"><h3>Aktywne zlecenia</h3><div id="aktywne-zlecenia-lista"></div></div><hr>
            
            <div class="table-section">
                <div class="collapsible-header" id="toggle-ukonczone">
                    <h3>Zakończone zlecenia</h3>
                    <span class="arrow">▶</span>
                </div>
                <div class="collapsible-content">
                    <div class="summary-controls">
                        <label for="miesiac-summary">Podsumowanie dla miesiąca:</label>
                        <input type="month" id="miesiac-summary">
                        <button id="export-zlecenia-btn" class="btn-edit">Eksportuj</button>
                    </div>
                    <div id="summary-container"></div>
                    <div id="ukonczone-zlecenia-lista"></div>
                </div>
            </div>
        </div>
        
        <div id="magazyn" class="tab-content">
            <h2>Magazyn</h2>
            <div class="magazyn-forms">
                <div class="form-section"><h3>Dodaj produkt</h3><form id="magazyn-form"><div class="form-group"><label for="item-index">Index:</label><input type="text" id="item-index" required></div><div class="form-group"><label for="item-name">Nazwa:</label><input type="text" id="item-name" required></div><div class="form-group"><label for="item-ilosc">Ilość:</label><input type="number" step="1" id="item-ilosc" required></div><div class="form-group"><label for="item-klient">Klient:</label><input type="text" id="item-klient"></div><button type="submit">Dodaj</button></form></div>
                <div class="form-section"><h3>Masowe dodawanie</h3><form id="bulk-add-form"><div class="form-group"><label for="bulk-klient">Klient:</label><input type="text" id="bulk-klient" required></div><div class="form-group"><label for="bulk-items">Produkty:</label><textarea id="bulk-items" rows="5" placeholder="Index;Nazwa;Ilość" required></textarea></div><button type="submit">Dodaj</button></form></div>
                <div class="form-section"><h3>Zarządzanie Olejami</h3><div class="form-group"><label for="oil-type">Typ Oleju:</label><select id="oil-type"><option value="HYGARD">HYGARD</option><option value="PLUS50">PLUS50</option><option value="COOLGARD">COOLGARD</option><option value="EXTGARD">EXTGARD</option></select></div><div class="form-group"><label for="oil-container-size">Pojemnik (L):</label><select id="oil-container-size"><option value="209">209L</option><option value="55">55L</option><option value="20">20L</option></select></div><button type="button" id="add-oil-btn" class="btn-add">Dodaj Olej</button><hr style="margin-top:1rem; margin-bottom: 1rem;"><h4>Przelicznik</h4><div class="form-group"><label for="converter-litry">Litry:</label><input type="number" step="0.01" id="converter-litry"></div><p>Wynik: <strong id="result-sztuki">0.00 szt.</strong></p><hr style="margin-top:1rem; margin-bottom: 1rem;"><div class="form-group"><label for="converter-sztuki">Sztuki:</label><input type="number" step="0.01" id="converter-sztuki"></div><p>Wynik: <strong id="result-litry">0.00 L</strong></p></div>
            </div>
            <div class="table-section"><h3>Stan Magazynowy</h3><table id="magazyn-table"><thead><tr><th>Index</th><th>Nazwa</th><th>Ilość (szt.)</th><th>Ilość (Litry)</th><th>Klient</th><th>Akcje</th></tr></thead><tbody id="magazyn-lista"></tbody></table></div>
        </div>
        <div id="zlecenia" class="tab-content">
            <h2>Zlecenia</h2>
            <div class="form-section">
                <h3>Dodaj nowe zlecenie</h3>
                <form id="zlecenie-form">
                    <div class="form-group"><label for="zlecenie-klient-select">1. Wybierz klienta (opcjonalnie):</label><select id="zlecenie-klient-select"><option value="">-- Wybierz --</option></select></div>
                    <div class="form-group"><label for="zlecenie-maszyna-select">2. Wybierz maszynę (opcjonalnie):</label><select id="zlecenie-maszyna-select" disabled><option value="">-- Najpierw wybierz klienta --</option></select></div>
                    <div class="form-group"><label for="nr-zlecenia">Nr zlecenia / Nazwa dla szybkiego zlecenia:</label><input type="text" id="nr-zlecenia" required></div>
                    <div class="form-group"><label for="opis-usterki">Opis usterki:</label><textarea id="opis-usterki" rows="3"></textarea></div>
                    <div class="form-group"><label for="motogodziny">Motogodziny (opcjonalnie):</label><input type="number" id="motogodziny" step="0.1"></div>
                    <button type="submit">Dodaj Zlecenie</button>
                </form>
            </div>

            <div class="form-section" style="padding: 1rem;">
                <input type="search" id="szukaj-zlecenia" placeholder="Szukaj po kliencie, maszynie, opisie, nr zlecenia...">
            </div>

            <div class="table-section"><h3>Aktywne zlecenia</h3><div id="aktywne-zlecenia-lista"></div></div><hr>
            
            <div class="table-section">
                <div class="collapsible-header" id="toggle-ukonczone">
                    <h3>Zakończone zlecenia</h3>
                    <span class="arrow">▶</span>
                </div>
                <div class="collapsible-content">
                    <div class="summary-controls">
                        <label for="miesiac-summary">Podsumowanie dla miesiąca:</label>
                        <input type="month" id="miesiac-summary">
                        <button id="export-zlecenia-btn" class="btn-edit">Eksportuj</button>
                    </div>
                    <div id="summary-container"></div>
                    <div id="ukonczone-zlecenia-lista"></div>
                </div>
            </div>
        </div>
        
        <div id="magazyn" class="tab-content">
            <h2>Magazyn</h2>
            <div class="magazyn-forms">
                <div class="form-section"><h3>Dodaj produkt</h3><form id="magazyn-form"><div class="form-group"><label for="item-index">Index:</label><input type="text" id="item-index" required></div><div class="form-group"><label for="item-name">Nazwa:</label><input type="text" id="item-name" required></div><div class="form-group"><label for="item-ilosc">Ilość:</label><input type="number" step="1" id="item-ilosc" required></div><div class="form-group"><label for="item-klient">Klient:</label><input type="text" id="item-klient"></div><button type="submit">Dodaj</button></form></div>
                <div class="form-section"><h3>Masowe dodawanie</h3><form id="bulk-add-form"><div class="form-group"><label for="bulk-klient">Klient:</label><input type="text" id="bulk-klient" required></div><div class="form-group"><label for="bulk-items">Produkty:</label><textarea id="bulk-items" rows="5" placeholder="Index;Nazwa;Ilość" required></textarea></div><button type="submit">Dodaj</button></form></div>
                <div class="form-section"><h3>Zarządzanie Olejami</h3><div class="form-group"><label for="oil-type">Typ Oleju:</label><select id="oil-type"><option value="HYGARD">HYGARD</option><option value="PLUS50">PLUS50</option><option value="COOLGARD">COOLGARD</option><option value="EXTGARD">EXTGARD</option></select></div><div class="form-group"><label for="oil-container-size">Pojemnik (L):</label><select id="oil-container-size"><option value="209">209L</option><option value="55">55L</option><option value="20">20L</option></select></div><button type="button" id="add-oil-btn" class="btn-add">Dodaj Olej</button><hr style="margin-top:1rem; margin-bottom: 1rem;"><h4>Przelicznik</h4><div class="form-group"><label for="converter-litry">Litry:</label><input type="number" step="0.01" id="converter-litry"></div><p>Wynik: <strong id="result-sztuki">0.00 szt.</strong></p><hr style="margin-top:1rem; margin-bottom: 1rem;"><div class="form-group"><label for="converter-sztuki">Sztuki:</label><input type="number" step="0.01" id="converter-sztuki"></div><p>Wynik: <strong id="result-litry">0.00 L</strong></p></div>
            </div>
            <div class="table-section"><h3>Stan Magazynowy</h3><table id="magazyn-table"><thead><tr><th>Index</th><th>Nazwa</th><th>Ilość (szt.)</th><th>Ilość (Litry)</th><th>Klient</th><th>Akcje</th></tr></thead><tbody id="magazyn-lista"></tbody></table></div>
        </div>
        </main>
    
    <div id="kalendarz-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2 id="kalendarz-modal-title">Ewidencja Czasu</h2>
            <form id="kalendarz-form">
                <input type="hidden" id="kalendarz-data">
                <div class="form-group"><label for="godziny-pracy">Godziny Pracy:</label><input type="number" step="0.5" id="godziny-pracy" value="0"></div>
                <div class="form-group"><label for="godziny-fakturowane">Godziny Wyfakturowane:</label><input type="number" step="0.5" id="godziny-fakturowane" value="0"></div>
                <div class="form-group"><label for="nadgodziny">Nadgodziny:</label><input type="number" step="0.5" id="nadgodziny" value="0"></div>
                <div class="form-group"><label for="godziny-jazdy">Czas Jazdy:</label><input type="number" step="0.5" id="godziny-jazdy" value="0"></div>
                <div class="form-group"><label for="kalendarz-notatka">Notatka:</label><textarea id="kalendarz-notatka" rows="2"></textarea></div>
                <button type="submit">Zapisz</button>
            </form>
        </div>
    </div>
    
    <div id="complete-zlecenie-modal" class="modal">
        <div class="modal-content"><span class="close-button">&times;</span><h2>Zakończ Zlecenie</h2><form id="complete-zlecenie-form"><input type="hidden" id="complete-zlecenie-id"><p><strong>Zlecenie:</strong> <span id="modal-zlecenie-nazwa"></span></p><div class="form-group"><label for="wyfakturowane-godziny">Wyfakturowane godziny:</label><input type="number" step="0.1" id="wyfakturowane-godziny" required></div><div class="form-group"><label for="typ-zlecenia">Typ zlecenia:</label><select id="typ-zlecenia" required><option value="S">S - Wyjazdowe (45zł)</option><option value="W">W - Warsztat (35zł)</option><option value="G">G - Gwarancja (35zł)</option><option value="Z">Z - Zbrojenie (30zł)</option><option value="P">P - Poprawka (0zł)</option></select></div><div id="modal-czesci-section"><hr><h3>Wybierz części z magazynu</h3><div id="modal-magazyn-lista" class="modal-stock-list"></div><h4>Wybrane części do zdjęcia:</h4><ul id="parts-to-remove-list"></ul></div><hr><button type="submit" class="btn-add">Zakończ i Zdejmij ze Stanu</button></form></div>
    </div>
    
    <div id="stock-change-modal" class="modal">
        <div class="modal-content"><span class="close-button">&times;</span><h2 id="stock-modal-title">Zmień stan</h2><form id="stock-change-form"><input type="hidden" id="stock-change-id"><p><strong>Produkt:</strong> <span id="stock-modal-name"></span></p><p><strong>Obecna ilość:</strong> <span id="stock-modal-current-qty"></span></p><div class="form-group"><label for="stock-change-qty">Ilość:</label><input type="number" step="1" id="stock-change-qty" required></div><button type="submit">Zatwierdź Zmianę</button></form></div>
    </div>
    
    <div id="assign-zlecenie-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2>Przypisz zlecenie</h2>
            <form id="assign-zlecenie-form">
                <input type="hidden" id="assign-zlecenie-id">
                <p><strong>Opis zlecenia:</strong> <span id="assign-zlecenie-opis"></span></p>
                <div class="form-group"><label for="assign-klient-select">1. Wybierz istniejącego klienta:</label><select id="assign-klient-select"></select></div>
                <p>...lub dodaj nowego:</p>
                <div class="form-group"><label for="assign-nowy-klient">Nazwa nowego klienta:</label><input type="text" id="assign-nowy-klient"></div><hr>
                <div id="assign-machine-section" style="display: none;">
                    <div class="form-group"><label for="assign-maszyna-select">2. Wybierz maszynę klienta:</label><select id="assign-maszyna-select"></select></div>
                    <p>...lub dodaj nową:</p>
                    <div class="form-group"><label for="assign-nowa-maszyna-typ">Typ:</label><select id="assign-nowa-maszyna-typ"><option value="">Wybierz</option><option value="Traktor">Traktor</option><option value="Kombajn">Kombajn</option><option value="Prasa">Prasa</option><option value="Inna">Inna</option></select></div>
                    <div class="form-group"><label for="assign-nowa-maszyna-model">Model:</label><input type="text" id="assign-nowa-maszyna-model"></div>
                </div>
                <button type="submit">Przypisz i Zapisz</button>
            </form>
        </div>
    </div>

    <div id="edit-klient-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2>Edytuj dane klienta</h2>
            <form id="edit-klient-form">
                <input type="hidden" id="edit-klient-id">
                <div class="form-group"><label for="edit-klient-nazwa">Nazwa / Imię i nazwisko:</label><input type="text" id="edit-klient-nazwa" required></div>
                <div class="form-group"><label for="edit-klient-nip">NIP:</label><input type="text" id="edit-klient-nip"></div>
                <div class="form-group"><label for="edit-klient-adres">Adres:</label><input type="text" id="edit-klient-adres"></div>
                <div class="form-group"><label for="edit-klient-telefon">Telefon:</label><input type="text" id="edit-klient-telefon"></div>
                <button type="submit">Zapisz Zmiany</button>
            </form>
        </div>
    </div>

    <div id="edit-maszyna-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2>Edytuj maszynę</h2>
            <form id="edit-maszyna-form">
                <input type="hidden" id="edit-maszyna-id">
                <div class="form-group"><label for="edit-maszyna-typ">Typ Maszyny:</label><select id="edit-maszyna-typ" required><option value="Traktor">Traktor</option><option value="Kombajn">Kombajn</option><option value="Prasa">Prasa</option><option value="Sieczkarnia">Sieczkarnia</option><option value="Opryskiwacz">Opryskiwacz</option><option value="Inna">Inna</option></select></div>
                <div class="form-group"><label for="edit-maszyna-model">Model:</label><input type="text" id="edit-maszyna-model" required></div>
                <div class="form-group"><label for="edit-maszyna-serial">Numer seryjny:</label><input type="text" id="edit-maszyna-serial"></div>
                <div class="form-group"><label for="edit-maszyna-rok">Rok produkcji:</label><input type="number" id="edit-maszyna-rok"></div>
                <div class="form-group"><label for="edit-maszyna-mth">Motogodziny:</label><input type="number" step="0.1" id="edit-maszyna-mth"></div>
                <button type="submit">Zapisz Zmiany</button>
            </form>
        </div>
    </div>
    
    <div id="zlecenie-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2 id="details-modal-title">Szczegóły zlecenia</h2>
            <div id="details-modal-content">
                </div>
        </div>
    </div>
    
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span><h2 id="history-modal-title">Historia zleceń</h2>
            <div id="history-modal-list" class="history-list">
                </div>
        </div>
    </div>

  </body>
</html>